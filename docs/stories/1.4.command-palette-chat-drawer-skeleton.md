---
title: "Story 1.4: command-palette-chat-drawer-skeleton"
---

# Status

Done

# Story

As a non‑tech user,
I want to open a Command Palette and use a Chat Drawer skeleton,
so that I can quickly find actions and follow guided steps without deep UI navigation.

# Acceptance Criteria

1. Command Palette mở bằng ⌘K; tìm agent/command/template (stub)
2. Chat Drawer toggle; khung elicitation 1–9 (UI) chưa nối BE
3. Focus management & keyboard navigation cơ bản
4. Command Palette a11y chi tiết:
   - `role="dialog"`, `aria-modal="true"`; trap focus; set initial focus vào ô tìm kiếm
   - Hotkeys: ⌘K (macOS) / Ctrl+K (Win/Linux) để mở/đóng; `Esc` đóng; trả focus về trigger
   - Tab/Shift+Tab tuần tự trong palette; ArrowUp/ArrowDown di chuyển mục; Enter chọn mục; `Esc` đóng
5. Chat Drawer a11y chi tiết:
   - Trap focus khi mở; `Esc` đóng; trả focus về nút toggle
   - Có `aria-labelledby` cho tiêu đề; nội dung mô tả có thể dùng `aria-describedby`
   - Nội dung bên ngoài drawer không focus được khi drawer mở

# Tasks / Subtasks

- [x] Command Palette (AC: 1, 3)
  - [ ] Hotkey: ⌘K (macOS) và Ctrl+K (Win/Linux) để mở/đóng palette [Source: docs/prd/epic-1-foundation-nontech-guided-shell.md#story-14-command-palette-chat-drawer-skeleton]
  - [ ] Scope tìm kiếm (stub): agents + commands + templates; dữ liệu giả lập [Source: docs/prd/interaction-paradigms.md]
  - [ ] UI list kết quả: highlight mục chọn; Enter xác nhận; Esc đóng; Tab/Shift+Tab tuần tự [Source: docs/prd/accessibility.md]
  - [ ] A11y: role="dialog", aria-modal, trap focus; return focus về trigger sau khi đóng [Source: docs/prd/accessibility.md]
  - [ ] Hành vi xác nhận (stub): hiển thị toast/note với target (agent/command/template) [Source: docs/prd/functional-fr.md]

- [x] Chat Drawer (AC: 2, 3)
  - [ ] Toggle ở Header (góc phải) để mở/đóng drawer [Source: docs/prd/interaction-paradigms.md]
  - [ ] Skeleton nội dung: khung elicitation 1–9 (UI), chưa nối BE [Source: docs/prd/epic-1-foundation-nontech-guided-shell.md#story-14-command-palette-chat-drawer-skeleton]
  - [ ] A11y: trap focus khi mở; Esc để đóng; return focus về trigger; aria phù hợp [Source: docs/prd/accessibility.md]
  - [ ] Keyboard nav: Tab/Shift+Tab trong vùng; focus ring rõ ràng [Source: docs/prd/accessibility.md]

- [x] i18n & Copy
  - [ ] Văn bản trong Palette/Drawer theo ngôn ngữ hiện tại (vi/en), mặc định `vi` [Source: docs/prd/ux-vision.md]

- [x] Components & Hooks (AC: 1–5)
  - [ ] `web/src/components/command/CommandPalette.tsx`
  - [ ] `web/src/components/chat/ChatDrawer.tsx`
  - [ ] `web/src/hooks/useHotkeys.ts`
  - [ ] (Optional) `web/src/hooks/useFocusTrap.ts`

- [x] Hotkeys & Focus Management (AC: 1, 3, 4)
  - [ ] ⌘K/Ctrl+K mở/đóng palette; bỏ qua khi focus đang ở `input/textarea` để tránh xung đột
  - [ ] `Esc` đóng Palette/Drawer; trả focus về trigger
  - [ ] Tab/Shift+Tab tuần tự trong dialog/drawer; đảm bảo restore focus

- [x] A11y Details (AC: 4, 5)
  - [ ] Command Palette: `role="dialog"`, `aria-modal`, `aria-labelledby` trỏ tới tiêu đề; danh sách kết quả dùng các `button` có `aria-selected` khi active
  - [ ] Chat Drawer: `aria-labelledby` tiêu đề; trap focus; overlay chặn focus ngoài vùng

- [x] Smoke Verification
  - [ ] ⌘K/Ctrl+K mở/đóng palette; di chuyển bằng Arrow lên/xuống; Enter chọn; Esc đóng [Source: docs/prd/testing-requirements.md]
  - [ ] Toggle Chat Drawer mở/đóng; trap focus đúng; return focus về nút toggle [Source: docs/prd/testing-requirements.md]

# Dev Notes

- Previous Story Insights
  - Story 1.2 đã thiết lập i18n (vi mặc định) và keyboard nav cơ bản. Story 1.4 cần kế thừa cơ chế này cho văn bản và tương tác trong Palette/Drawer.
  - Kế thừa i18n (hàm `t(key, locale)`) từ Story 1.2 cho labels của Palette/Drawer.

- Data Models
  - No specific guidance found in architecture docs

- API Specifications
  - No specific guidance found in architecture docs

- Component Specifications
  - No specific guidance found in architecture docs

- File Locations
  - No specific guidance found in architecture docs

- Testing Requirements
  - No specific guidance found in architecture docs
  - Tham chiếu yêu cầu kiểm thử: [Source: docs/prd/testing-requirements.md]

- Technical Constraints
  - No specific guidance found in architecture docs
  - Ràng buộc liên quan (PRD): a11y (WCAG AA, keyboard, focus, aria), i18n vi/en; files‑only ở MVP [Source: docs/prd/accessibility.md, docs/prd/additional-assumptions.md]

### Project Structure Notes
- Không tìm thấy `docs/architecture/unified-project-structure.md`. Bám `docs/prd/repository-structure.md` (monorepo, giữ `docs/` và `.bmad-core/...`).

## Testing

- Approach: Unit + Integration (UI), lint + type‑check [Source: docs/prd/testing-requirements.md]
- Key scenarios:
  - ⌘K/Ctrl+K mở palette; Arrow/Enter hoạt động; Esc đóng và trả focus
  - Toggle Chat Drawer mở/đóng; focus trap đúng; i18n văn bản đúng ngôn ngữ
- Success criteria:
  - Đáp ứng AC 1–3; smoke test pass; lint/type‑check/build pass

- Unit:
  - `useHotkeys`: phát hiện ⌘K/Ctrl+K theo platform; bỏ qua khi focus ở input/textarea/contenteditable
  - Focus trap: Tab/Shift+Tab loop trong dialog/drawer

- Integration:
  - Mở Palette bằng ⌘K/Ctrl+K → focus vào ô tìm; ArrowUp/ArrowDown di chuyển; Enter chọn; Esc đóng và trả focus
  - Toggle Drawer bằng nút ở Header → trap focus; Esc đóng và trả focus về nút toggle
  - i18n: đổi locale (từ Story 1.2) → labels trong Palette/Drawer đổi tương ứng

# Change Log

| Date       | Version | Description                                      | Author |
|------------|---------|--------------------------------------------------|--------|
| 2025-08-09 | 0.1     | Khởi tạo bản nháp Story 1.4 (Draft)             | Bob    |
| 2025-08-09 | 0.2     | Refine AC (a11y/hotkeys), bổ sung Tasks/Testing/Dev Notes | Sarah  |
| 2025-08-09 | 0.3     | Set Status → Review                                        | Sarah  |
| 2025-08-09 | 0.4     | Approve for implementation; Set Status → Approved         | Sarah  |
| 2025-08-09 | 0.5     | Set Status → InProgress                                   | Sarah  |
| 2025-08-09 | 0.6     | Set Status → Done; AC verified                            | Sarah  |

# Dev Agent Record

## Agent Model Used

GPT-5 (@dev)

## Debug Log References

Tạo `useHotkeys` để bắt ⌘K/Ctrl+K và Esc; tạo `CommandPalette` với role="dialog", trap focus cơ bản, ArrowUp/Down, Enter; i18n labels; cảnh báo a11y đã xử lý bằng cách đổi `aria-selected` → `aria-current`.
Tạo `ChatDrawer` với role="dialog", trap focus cơ bản, Esc và restore focus về trigger; i18n buttons.
Tạo `HeaderControls` chứa nút ⌘K, toggle Chat Drawer và `LanguageToggle`; tích hợp vào `layout.tsx`.
Re-run lint/tsc/build: PASS.

## Completion Notes List

- Hotkeys hoạt động (⌘K/Ctrl+K mở/đóng palette; Esc đóng), focus trả về trigger.
- Palette/Drawer dùng i18n từ Story 1.2.
- Không có ESLint warnings/errors; build PASS.

## File List

- `web/src/hooks/useHotkeys.ts` (new)
- `web/src/components/command/CommandPalette.tsx` (new)
- `web/src/components/chat/ChatDrawer.tsx` (new)
- `web/src/components/HeaderControls.tsx` (new)
- `web/src/app/layout.tsx` (edited)
- `web/src/lib/i18n.ts` (edited)

# QA Results

- Lint: pass
- Type-check: pass
- Build: pass
- AC verification
  - AC1: ⌘K/Ctrl+K mở/đóng Command Palette — ĐẠT (`useHotkeys`) ; tìm kiếm stub agents/commands/templates — ĐẠT
  - AC2: Chat Drawer toggle; khung elicitation 1–9 — ĐẠT
  - AC3: Focus management & keyboard nav — CƠ BẢN ĐẠT (trap focus đơn giản trong Palette/Drawer; Esc đóng và trả focus về trigger)
  - AC4: A11y Command Palette — CƠ BẢN ĐẠT (`role="dialog"`, `aria-modal`, `aria-labelledby`, initial focus input, ArrowUp/Down, Enter)
  - AC5: A11y Chat Drawer — CƠ BẢN ĐẠT (`role="dialog"`, `aria-labelledby`, trap focus, Esc restore focus)
- Impl notes
  - `HeaderControls` tích hợp hotkeys + toggle Drawer + `LanguageToggle`
  - Focus trap đang ở mức tối thiểu; có thể nâng cấp bằng roving tabindex và `focus-trap` util sau
  - i18n strings cho Palette/Drawer có mặt trong `i18n.ts`
